#!/bin/zsh

# This was written by Copilot.

function timed-say() {
    # Start timing
    local start=$EPOCHREALTIME

    # Run the command
    eval "$@"
    local return_status=$?

    # End timing
    local end=$EPOCHREALTIME

    # Calculate and format duration
    local duration=$(( end - start ))

    # Format seconds with milliseconds
    local formatted_time
    formatted_time=$(printf "%.3f" $duration)

    # Speak the result - use subshell to completely suppress job control messages
    if (( return_status == 0 )); then
        (say "The command succeeded in $formatted_time seconds." &) >/dev/null 2>&1
    else
        (say "The command failed in $formatted_time seconds." &) >/dev/null 2>&1
    fi
}

compdef _precommand timed-say
